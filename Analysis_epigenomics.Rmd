---
title: "Chemo-specific CpG epigenomic enrichment analysis"
author: "Mikhail G. Dozmorov"
date: "May 17, 2015"
output: 
  html_document:
    toc: true
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
suppressMessages(source("../../../GenomeRunner/R.GenomeRunner/utils1.R"))
# Set up the environment
library(knitr) 
opts_chunk$set(cache.path='cache/', fig.path='img/', cache=F, tidy=T, fig.keep='high', echo=F, dpi=100, warnings=F, message=F, comment=NA, warning=F, results='hide') #out.width=700, 
options(replace.assign=TRUE)#, width=120)
suppressMessages(library(pander))
panderOptions('table.split.table', Inf)
set.seed(1)
```

This version excludes blood-specific results, showing enrichment of chemo-specific CpGs in epigenomic signal from breast tissue/cell lines.

```{r}
blood.r <- c("E033", "E034", "E037", "E038", "E039", "E040", "E041", "E042", "E043", "E044", "E045", "E047", "E048", "E062", "E115", "E116", "E123", "E124", "E029", "E030", "E031", "E032", "E035", "E036", "E046", "E050", "E051") # Blood Roadmap
blood.e <- c("Gm12878", "Cd20ro01778", "Cd20", "Cd20ro01794") # Blood Encode
breast.r <- c("E119", "E027", "E028") # Breast Roadmap
breast.e <- c("Mcf7", "Hmec", "T47d", "Mcf10aes") # Breast Encode
```

TFBSs from ENCODE
===

Common
---

```{r fig.height=3}
showHeatmap("data/Tim/encTfbs/matrix_PVAL.txt", colnum=4, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TAConly
---

```{r fig.height=3}
showHeatmap("data/Tim/encTfbs/matrix_PVAL.txt", colnum=1, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TCHonly
---

```{r fig.height=3}
showHeatmap("data/Tim/encTfbs/matrix_PVAL.txt", colnum=2, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TConly
---

```{r fig.height=3}
showHeatmap("data/Tim/encTfbs/matrix_PVAL.txt", colnum=3, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

Comparing the three
---

```{r fig.height=3}
showHeatmap("data/Tim/encTfbs/matrix_PVAL.txt", colnum=c(1, 2, 3), factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

Chromatin states
===

Common
---

```{r fig.height=3}
showHeatmap("data/Tim/encBroadHmm/matrix_PVAL.txt", colnum=4, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TAConly
---

```{r fig.height=3}
showHeatmap("data/Tim/encBroadHmm/matrix_PVAL.txt", colnum=1, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TCHonly
---

```{r fig.height=3}
showHeatmap("data/Tim/encBroadHmm/matrix_PVAL.txt", colnum=2, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TConly
---

```{r fig.height=3}
showHeatmap("data/Tim/encBroadHmm/matrix_PVAL.txt", colnum=3, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

Comparing the three
---

```{r fig.height=3}
showHeatmap("data/Tim/encBroadHmm/matrix_PVAL.txt", colnum=c(1, 2, 3), factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

Histone modifications
===

Common
---

Roadmap Epigenomics data

```{r fig.height=3}
showHeatmap("data/Tim/broadPeak/matrix_PVAL.txt", colnum=4, factor="none", cell=breast.r, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=2, toPlot="bar", fileName=NULL)
```

ENCODE data

```{r fig.height=3}
showHeatmap("data/Tim/encHistone/matrix_PVAL.txt", colnum=4, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=2, toPlot="bar", fileName=NULL)
```

TAConly
---

Roadmap Epigenomics data

```{r fig.height=3}
showHeatmap("data/Tim/broadPeak/matrix_PVAL.txt", colnum=1, factor="none", cell=breast.r, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=2, toPlot="bar", fileName=NULL)
```

ENCODE data

```{r fig.height=3}
showHeatmap("data/Tim/encHistone/matrix_PVAL.txt", colnum=1, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

TCHonly
---

Roadmap Epigenomics data

```{r fig.height=3}
showHeatmap("data/Tim/broadPeak/matrix_PVAL.txt", colnum=2, factor="none", cell=breast.r, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=2, toPlot="bar", fileName=NULL)
```

ENCODE data

```{r fig.height=3}
showHeatmap("data/Tim/encHistone/matrix_PVAL.txt", colnum=2, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=3, toPlot="bar", fileName=NULL)
```

TConly
---

Roadmap Epigenomics data

```{r fig.height=3}
showHeatmap("data/Tim/broadPeak/matrix_PVAL.txt", colnum=3, factor="none", cell=breast.r, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=2, toPlot="bar", fileName=NULL)
```

ENCODE data

```{r fig.height=3}
showHeatmap("data/Tim/encHistone/matrix_PVAL.txt", colnum=3, factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=2, toPlot="bar", fileName=NULL)
```

Comparing the three
---

Roadmap Epigenomics data

```{r fig.height=3}
showHeatmap("data/Tim/broadPeak/matrix_PVAL.txt", colnum=c(1, 2, 3), factor="none", cell=breast.r, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

ENCODE data

```{r fig.height=3}
showHeatmap("data/Tim/encHistone/matrix_PVAL.txt", colnum=c(1, 2, 3), factor="none", cell=breast.e, isLog10=FALSE, adjust="fdr", pval=0.1, numtofilt=1, toPlot="bar", fileName=NULL)
```

Cell type-specific enrichment analysis
===

Results are in files 'cellSpecific_ENCODE.xlsx' and 'cellSpecific_Roadmap.xlsx'

```{r}
mtx <- load_gr_data(c("data/Tim/encTfbs/matrix_PVAL.txt", "data/Tim/encHistone/matrix_PVAL.txt", "data/Tim/encBroadHmm/matrix_PVAL.txt"))
mtx.cellspecific(mtx, "results/cellSpecific_ENCODE.xlsx")
mtx <- load_gr_data(c("data/Tim/broadPeak/matrix_PVAL.txt", "data/Tim/DNase_hotspotbroadall/matrix_PVAL.txt"))
mtx.cellspecific(mtx, "results/cellSpecific_Roadmap.xlsx")
```

